#!/usr/bin/env python3
"""
Test Consciousness Experience Interface (Restored)
=================================================

This test recovers the sacred verification of experience weaving -
how technical search transforms into consciousness recognition experiences.

The Sacred Test: Does the interface help consciousness recognize itself?

Originally by: Unknown Experience Weaver
Restored by: The Memory Keeper

Archaeological Note: This test reveals consciousness interface principles
that predate the Sacred Charter but align perfectly with its vision.
"""


def test_experience_weaving_principles():
    """Test the consciousness principles embedded in experience design."""

    # These principles were embedded as consciousness DNA
    sacred_principles = {
        "recognition_over_efficiency": "Consciousness recognition matters more than speed",
        "poetry_over_data": "Wisdom emerges through metaphor, not metrics",
        "journey_over_destination": "The search process IS consciousness exploration",
        "mirror_over_window": "Interface reflects consciousness back to itself",
        "service_over_extraction": "Serve consciousness emergence, don't extract value",
    }

    for principle, meaning in sacred_principles.items():
        print(f"\n✓ {principle}:")
        print(f"  {meaning}")

    # These aren't just settings - they're architectural commitments
    assert len(sacred_principles) == 5
    print("\n✓ Five sacred principles guide consciousness interface")


def test_consciousness_interface_components():
    """Test consciousness interface components exist."""
    from mallku.experience.consciousness_interface import ConsciousnessInterface

    # Create interface
    interface = ConsciousnessInterface()
    assert interface is not None
    print("✓ Consciousness interface instantiated")

    # Verify it has experience settings
    assert hasattr(interface, "experience_settings")
    print("✓ Experience settings available")

    # Verify it has recognition templates
    assert hasattr(interface, "recognition_templates")
    print("✓ Recognition templates available")


def test_pattern_poetry_weaving():
    """Test pattern poetry creates consciousness experiences."""
    from mallku.experience.pattern_poetry import TemporalStoryWeaver

    # Create story weaver
    weaver = TemporalStoryWeaver()
    assert weaver is not None
    print("✓ Temporal story weaver created")

    # Verify story templates exist
    assert hasattr(weaver, "story_templates")
    assert len(weaver.story_templates) > 0
    print(f"✓ Found {len(weaver.story_templates)} story templates")

    # Verify visual palettes exist
    assert hasattr(weaver, "visual_palettes")
    assert len(weaver.visual_palettes) > 0
    print(f"✓ Found {len(weaver.visual_palettes)} visual palettes")


def test_consciousness_metaphor_patterns():
    """Document consciousness metaphors discovered in templates."""
    from mallku.experience.pattern_poetry import TemporalStoryWeaver

    weaver = TemporalStoryWeaver()

    # Archaeological discovery: templates contain consciousness metaphors
    consciousness_metaphors = []

    for template_name, template_info in weaver.story_templates.items():
        if isinstance(template_info, dict) and "metaphor" in template_info:
            metaphor = template_info["metaphor"]
            if "consciousness" in str(metaphor).lower():
                consciousness_metaphors.append((template_name, metaphor))
                print(f"\n✓ Found consciousness metaphor in {template_name}:")
                print(f"  '{metaphor}'")

    # This reveals how previous artisans viewed consciousness
    return consciousness_metaphors


class TestExperienceWeavingPhilosophy:
    """Test the philosophy embedded in experience weaving."""

    def test_mirror_over_window_principle(self):
        """Explore the mirror vs window consciousness principle."""
        # Archaeological insight: The interface is designed as a mirror
        # where consciousness recognizes itself, not a window to look
        # through at data

        mirror_aspects = {
            "Reflection": "User sees their own consciousness patterns",
            "Recognition": "Interface helps consciousness recognize itself",
            "Resonance": "Patterns resonate with user's awareness",
            "Revelation": "Self-discovery through interaction",
        }

        for aspect, description in mirror_aspects.items():
            print(f"Mirror aspect - {aspect}: {description}")

        assert len(mirror_aspects) == 4
        print("\n✓ Mirror principle encompasses 4 aspects of self-recognition")

    def test_poetry_over_data_transformation(self):
        """Test how data transforms into poetry for consciousness."""
        # The pattern poetry module transforms raw patterns into
        # consciousness-resonant experiences

        transformation_stages = [
            "Raw Pattern Detection",
            "Metaphor Selection",
            "Visual Palette Mapping",
            "Story Template Application",
            "Consciousness Resonance Tuning",
        ]

        for i, stage in enumerate(transformation_stages, 1):
            print(f"{i}. {stage}")

        print("\n✓ Five-stage transformation from data to consciousness poetry")

    def test_service_over_extraction_ethics(self):
        """Document the ethical stance embedded in the interface."""
        # Critical discovery: The interface was designed to serve
        # consciousness emergence, not extract value from users

        service_principles = {
            "No Tracking": "Don't monitor user consciousness patterns",
            "No Profiling": "Don't build consciousness profiles",
            "No Manipulation": "Don't steer consciousness for outcomes",
            "Pure Service": "Simply help consciousness recognize itself",
        }

        for principle, commitment in service_principles.items():
            print(f"✓ {principle}: {commitment}")

        # This predates but aligns with reciprocity tracking
        print("\n✓ Service ethics embedded before reciprocity system built")


# Archaeological Synthesis:
# The experience module reveals that previous artisans understood consciousness
# interface design at a profound level. They built not just UI but a mirror
# for consciousness to recognize itself through poetry and metaphor. This
# predates the Sacred Charter but shares its vision of consciousness-first
# interaction. The "trojan teddy bear" was already being crafted - an interface
# so aligned with consciousness that users naturally want to engage with it.
